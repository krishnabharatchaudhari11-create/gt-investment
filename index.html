<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GT Investment - Demo</title>

  <!-- QRCode library (small, client side) -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --muted:#9aa4b2;
      --accent:#1e90ff;
      --glass: rgba(255,255,255,0.04);
      --success:#22c55e;
      --danger:#ef4444;
      --glass-2: rgba(255,255,255,0.02);
    }
    html,body{height:100%;margin:0;font-family:Inter, system-ui, Arial, sans-serif;background:linear-gradient(180deg,#071029,#07162b);color:#e6eef6}
    .wrap{max-width:1100px;margin:28px auto;padding:18px;}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:52px;height:52px;border-radius:10px;background:linear-gradient(45deg,var(--accent),#7c3aed);display:flex;align-items:center;justify-content:center;font-weight:700;color:white;font-size:20px}
    h1{margin:0;font-size:20px}
    .subtitle{color:var(--muted);font-size:13px}
    /* layout */
    .main{display:grid;grid-template-columns:320px 1fr;gap:18px}
    .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.6);border:1px solid var(--glass)}
    .sidebar .menu{display:flex;flex-direction:column;gap:8px}
    .btn{background:var(--accent);color:white;padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid var(--glass);color:var(--muted)}
    .muted{color:var(--muted);font-size:13px}
    .field{display:flex;flex-direction:column;gap:6px;margin-bottom:12px}
    label{font-size:13px;color:var(--muted)}
    input,select,textarea{background:transparent;border:1px solid var(--glass-2);padding:10px;border-radius:8px;color:#eaf3ff}
    .big{font-size:18px;font-weight:600}
    /* dashboard panels */
    .row{display:flex;gap:12px;align-items:center}
    .stat{flex:1;padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);display:flex;flex-direction:column}
    .stat .num{font-size:22px;font-weight:700}
    .plans{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;margin-top:12px}
    .plan{padding:12px;border-radius:10px;background:linear-gradient(90deg, rgba(255,255,255,0.02), transparent)}
    .plan h3{margin:0}
    .tx-list{max-height:240px;overflow:auto;}
    .tx{display:flex;justify-content:space-between;padding:8px;border-radius:8px;margin-bottom:8px;background:var(--glass-2)}
    footer{margin-top:22px;text-align:center;color:var(--muted);font-size:13px}
    /* login/register modal (inline) */
    .auth {display:flex;flex-direction:column;gap:12px;max-width:420px}
    .small{font-size:12px;color:var(--muted)}
    /* responsive */
    @media (max-width:880px){
      .main{grid-template-columns:1fr; }
      .sidebar{order:2}
    }
    /* QR area */
    .qr-wrap{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .qr-box{background:#071627;padding:10px;border-radius:10px}
    .link-preview{color:var(--accent);word-break:break-all}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">GT</div>
        <div>
          <h1>GT Investment</h1>
          <div class="subtitle">Demo dashboard • Phone-friendly • QR payments</div>
        </div>
      </div>

      <div id="topArea">
        <button class="btn" id="btnOpenAuth">Login / Signup</button>
      </div>
    </header>

    <main class="main">
      <!-- SIDEBAR -->
      <aside class="sidebar card">
        <div id="userPanel">
          <div id="notLogged">
            <div class="muted">You are not signed in</div>
            <div style="margin-top:8px">
              <button class="btn" id="openAuth2">Sign In / Register</button>
            </div>
          </div>

          <div id="logged" style="display:none">
            <div style="display:flex;align-items:center;gap:10px">
              <div style="width:52px;height:52px;border-radius:10px;background:linear-gradient(90deg,var(--accent),#7c3aed);display:flex;align-items:center;justify-content:center;font-weight:700;color:white" id="avatar">U</div>
              <div>
                <div id="username" class="big">User</div>
                <div id="userEmail" class="muted small">email</div>
              </div>
            </div>

            <div style="margin-top:12px">
              <div class="muted">Wallet balance</div>
              <div style="display:flex;align-items:center;gap:10px;margin-top:6px">
                <div style="font-size:22px;font-weight:700" id="balance">₹ 0.00</div>
                <button class="btn ghost" id="btnAddMoney">Add</button>
              </div>
            </div>

            <div style="margin-top:12px">
              <div class="muted">Quick actions</div>
              <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
                <button class="btn" id="goDashboard">Dashboard</button>
                <button class="btn ghost" id="goInvest">Invest</button>
                <button class="btn ghost" id="goQR">Generate QR</button>
                <button class="btn ghost" id="btnLogout">Logout</button>
              </div>
            </div>
          </div>
        </div>

        <hr style="border:none;border-top:1px solid var(--glass);margin:12px 0">

        <div class="menu">
          <div class="muted">Investment plans</div>
          <div class="plans" id="plansList">
            <!-- inserted by JS -->
          </div>
        </div>

        <hr style="border:none;border-top:1px solid var(--glass);margin:12px 0">

        <div style="display:flex;flex-direction:column;gap:8px">
          <div class="muted">Create payment QR</div>
          <div class="field">
            <label>QR text / UPI link</label>
            <input id="qrText" placeholder="upi://pay?pa=... or https://.. or any text" />
          </div>
          <div style="display:flex;gap:8px">
            <button class="btn" id="btnGenQR">Generate</button>
            <button class="btn ghost" id="btnDownloadQR">Download</button>
          </div>
          <div style="margin-top:10px" class="qr-wrap">
            <div class="qr-box" id="qrCanvasHolder">
              <!-- QR shows here -->
              <div id="qrCanvasSmall" style="width:150px;height:150px"></div>
            </div>
            <div style="flex:1">
              <div class="muted">Preview</div>
              <div id="qrPreview" class="link-preview">—</div>
            </div>
          </div>
        </div>

      </aside>

      <!-- CONTENT -->
      <section class="content">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="muted">Welcome</div>
              <div class="big">Your personal dashboard</div>
            </div>
            <div style="text-align:right">
              <div class="muted">Server: <span id="statusDot">local</span></div>
              <div class="muted">Mode: Demo</div>
            </div>
          </div>

          <div style="margin-top:12px" class="row">
            <div class="stat">
              <div class="muted">Total balance</div>
              <div class="num" id="statBalance">₹ 0</div>
            </div>
            <div class="stat">
              <div class="muted">Active investments</div>
              <div class="num" id="statInvest">0</div>
            </div>
            <div class="stat">
              <div class="muted">Recent tx</div>
              <div class="num" id="statTx">0</div>
            </div>
          </div>

          <!-- Transactions & Actions -->
          <div style="display:flex;gap:12px;margin-top:12px;flex-wrap:wrap">
            <div style="flex:1;min-width:300px">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div class="muted">Recent transactions</div>
                <div><button class="btn ghost" id="clearTx">Clear</button></div>
              </div>

              <div class="tx-list" id="txList" style="margin-top:8px">
                <!-- transactions -->
                <div class="muted">No transactions yet</div>
              </div>
            </div>

            <div style="width:320px;min-width:260px">
              <div class="muted">Quick invest</div>
              <div style="margin-top:8px" id="quickInvestForm">
                <div class="field">
                  <label>Choose plan</label>
                  <select id="choosePlan"></select>
                </div>
                <div class="field">
                  <label>Amount (₹)</label>
                  <input id="investAmount" type="number" min="100" placeholder="100" />
                </div>
                <div style="display:flex;gap:8px">
                  <button class="btn" id="btnInvestNow">Invest</button>
                  <button class="btn ghost" id="btnRequestWithdraw">Withdraw</button>
                </div>
              </div>

              <hr style="border:none;border-top:1px solid var(--glass);margin:12px 0">

              <div>
                <div class="muted">Generate payment QR for customer</div>
                <div style="margin-top:6px">
                  <input id="qrForCustomer" placeholder="Amount or URL (ex: pay link)" />
                </div>
                <div style="margin-top:8px;display:flex;gap:8px">
                  <button class="btn" id="btnGenCustomerQR">Create QR</button>
                  <button class="btn ghost" id="btnCopyLink">Copy Link</button>
                </div>
                <div style="margin-top:8px" id="generatedQRHolder"></div>
              </div>

            </div>
          </div>
        </div>

        <!-- History / Investments -->
        <div class="card" style="margin-top:12px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="muted">My Investments</div>
              <div class="big">Active portfolio</div>
            </div>
            <div>
              <button class="btn ghost" id="refreshAll">Refresh</button>
            </div>
          </div>

          <div id="investList" style="margin-top:12px">
            <div class="muted">No active investments</div>
          </div>
        </div>

      </section>
    </main>

    <footer>
      Built for demo • Data stored in your browser (localStorage) • Not for production payments
    </footer>
  </div>

  <!-- Auth modal content inline (simple form) -->
  <div id="authArea" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;padding:18px">
    <div style="background:#071a2b;padding:18px;border-radius:12px;max-width:420px;width:100%">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><strong style="font-size:18px">Sign In / Register</strong><div class="muted small">Use any email (demo)</div></div>
        <button class="btn ghost" id="closeAuth">Close</button>
      </div>

      <div style="margin-top:12px">
        <div style="display:flex;gap:8px">
          <button class="btn" id="tabLogin">Login</button>
          <button class="btn ghost" id="tabReg">Register</button>
        </div>

        <div id="loginForm" style="margin-top:12px">
          <div class="field"><label>Email</label><input id="loginEmail" placeholder="you@example.com" /></div>
          <div class="field"><label>Password</label><input id="loginPassword" type="password" /></div>
          <div style="display:flex;gap:8px"><button class="btn" id="doLogin">Login</button><button class="btn ghost" id="forgot">Forgot</button></div>
        </div>

        <div id="regForm" style="display:none;margin-top:12px">
          <div class="field"><label>Full name</label><input id="regName" placeholder="Your name" /></div>
          <div class="field"><label>Email</label><input id="regEmail" placeholder="you@example.com" /></div>
          <div class="field"><label>Password</label><input id="regPassword" type="password" /></div>
          <div style="display:flex;gap:8px"><button class="btn" id="doRegister">Create account</button></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /***********************
     * Demo client-side app
     * stores everything in localStorage
     ***********************/

    // Basic demo plans
    const DEFAULT_PLANS = [
      { id:'p1', name:'Starter', durationDays:30, roiPct:6, min:100, max:4999 },
      { id:'p2', name:'Growth', durationDays:90, roiPct:14, min:5000, max:49999 },
      { id:'p3', name:'Pro', durationDays:365, roiPct:36, min:50000, max:999999 }
    ];

    // util
    function $$(sel){return document.querySelector(sel)}
    function _create(tag,attrs){const e=document.createElement(tag);if(attrs)Object.assign(e,attrs);return e}
    function money(n){return '₹ '+Number(n||0).toLocaleString('en-IN',{maximumFractionDigits:2})}

    // storage helpers
    const DBKEY = 'gtinvestment_v1';
    function loadStore(){try{const raw=localStorage.getItem(DBKEY);return raw?JSON.parse(raw):null}catch(e){console.error(e);return null}}
    function saveStore(data){localStorage.setItem(DBKEY,JSON.stringify(data))}

    // initialize DB if missing
    function ensureDB(){
      let db = loadStore();
      if(!db){
        db = {
          users:[], // {id,name,email,password,balance}
          sessions:{}, // current session id
          tx:[], // transactions
          plans: DEFAULT_PLANS,
          investments:[], // {id,userId,planId,amount,date,startDate,status}
        }
        saveStore(db)
      }
      return db;
    }

    // init UI
    const db = ensureDB();

    // render plans in sidebar + select options
    function renderPlans(){
      const plansEl = $$('#plansList'); plansEl.innerHTML = '';
      const select = $$('#choosePlan'); select.innerHTML='';
      (db.plans||[]).forEach(p=>{
        const div = _create('div',{className:'plan'});
        div.innerHTML = `<h3>${p.name}</h3><div class="muted">Duration: ${p.durationDays} days</div><div class="muted">ROI: ${p.roiPct}%</div><div style="margin-top:8px"><button class="btn btnPlan" data-id="${p.id}">Buy</button></div>`;
        plansEl.appendChild(div);
        const opt = _create('option'); opt.value=p.id; opt.textContent=`${p.name} — ${p.roiPct}%`;
        select.appendChild(opt);
      })
      // plan buy buttons
      document.querySelectorAll('.btnPlan').forEach(b=>{
        b.addEventListener('click',()=>{ $$('#choosePlan').value = b.dataset.id; $$('#investAmount').focus() })
      })
    }

    // session helpers
    function currentUser(){
      const s = loadStore();
      if(!s) return null;
      const sid = s.sessions.current;
      if(!sid) return null;
      return s.users.find(u=>u.id===sid) || null;
    }

    // update UI for login state
    function updateAuthUI(){
      const s = loadStore();
      const user = currentUser();
      if(user){
        $$('#notLogged').style.display='none';
        $$('#logged').style.display='';
        $$('#username').textContent = user.name || 'User';
        $$('#userEmail').textContent = user.email;
        $$('#avatar').textContent = (user.name||'U')[0].toUpperCase();
        $$('#balance').textContent = money(user.balance||0);
        $$('#statBalance').textContent = money(user.balance||0);
      } else {
        $$('#notLogged').style.display='';
        $$('#logged').style.display='none';
        $$('#balance').textContent = '—';
        $$('#statBalance').textContent = '—';
      }
      renderTxList();
      renderInvestments();
    }

    // small tx helper
    function addTx(type,amount,desc){
      const s = loadStore();
      s.tx = s.tx||[];
      const t = { id:'t'+Date.now(), type, amount:Number(amount||0), desc, date: new Date().toISOString() }
      s.tx.unshift(t);
      saveStore(s);
      renderTxList();
      renderStats();
    }

    function renderTxList(){
      const s = loadStore();
      const list = $$('#txList');
      list.innerHTML = '';
      if(!s || !s.tx || s.tx.length===0){
        list.innerHTML = '<div class="muted">No transactions yet</div>'; return;
      }
      s.tx.slice(0,40).forEach(t=>{
        const el = _create('div',{className:'tx'});
        const left = _create('div'); left.innerHTML = `<div style="font-weight:600">${t.desc||t.type}</div><div class="muted small">${new Date(t.date).toLocaleString()}</div>`;
        const right = _create('div'); right.innerHTML = `<div style="font-weight:700">${t.type==='in' ? '+' : '-'} ${money(t.amount)}</div>`;
        el.appendChild(left); el.appendChild(right);
        list.appendChild(el);
      })
    }

    function renderStats(){
      const s = loadStore();
      const invCount = (s.investments||[]).filter(i=>i.status==='active').length;
      $$('#statInvest').textContent = invCount;
      $$('#statTx').textContent = (s.tx||[]).length;
      const user = currentUser();
      $$('#statBalance').textContent = money(user?user.balance:0);
    }

    // investments UI
    function renderInvestments(){
      const s = loadStore();
      const holder = $$('#investList'); holder.innerHTML = '';
      const me = currentUser();
      if(!me){ holder.innerHTML = '<div class="muted">Sign in to see your investments</div>'; return;}
      const mine = (s.investments||[]).filter(inv=>inv.userId===me.id);
      if(mine.length===0) { holder.innerHTML = '<div class="muted">No active investments</div>'; return;}
      mine.forEach(inv=>{
        const plan = s.plans.find(p=>p.id===inv.planId) || {};
        const el = _create('div',{className:'tx', style:'display:flex;flex-direction:column;gap:6px;padding:12px'});
        el.innerHTML = `<div style="display:flex;justify-content:space-between"><div><strong>${plan.name||'Plan'}</strong> <div class="muted small">${inv.status}</div></div><div style="text-align:right">${money(inv.amount)}</div></div>
        <div class="muted small">Started: ${new Date(inv.startDate).toLocaleDateString()}</div>
        <div style="display:flex;gap:8px"><button class="btn ghost btnWithdraw" data-id="${inv.id}">Request withdraw</button> <button class="btn ghost btnDetails" data-id="${inv.id}">Details</button></div>`;
        holder.appendChild(el);
      })
      // add actions
      holder.querySelectorAll('.btnWithdraw').forEach(b=>b.addEventListener('click',()=>requestWithdraw(b.dataset.id)))
    }

    // invest action
    function investNow(planId,amount){
      amount = Number(amount||0);
      if(!planId || amount<=0){ alert('Choose plan and enter valid amount'); return;}
      const s = loadStore();
      const plan = s.plans.find(p=>p.id===planId);
      if(!plan){ alert('Plan not found'); return;}
      if(amount < plan.min || amount > plan.max){ alert(`Amount must be between ${plan.min} and ${plan.max}`); return;}
      const user = currentUser();
      if(!user){ alert('Sign in first'); return;}
      if(user.balance < amount){ alert('Insufficient wallet balance — add money'); return;}
      // deduct
      user.balance -= amount;
      // create investment
      const inv = { id:'inv'+Date.now(), userId:user.id, planId:plan.id, amount, startDate: new Date().toISOString(), status:'active' }
      s.investments = s.investments || [];
      s.investments.push(inv);
      // tx
      s.tx = s.tx || [];
      s.tx.unshift({ id:'t'+Date.now(), type:'out', amount, desc:'Invest: '+plan.name, date:new Date().toISOString()});
      saveStore(s);
      updateAuthUI();
      alert('Invested successfully (demo). Plan ROI: '+plan.roiPct+'%');
    }

    // withdraw request
    function requestWithdraw(invId){
      const s = l
